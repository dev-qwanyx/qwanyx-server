{% extends 'mon-autodin/base.html' %}

{% block title %}Mon profil - Mon Autodin{% endblock %}

{% block content %}
<div class="box">
    <h1 class="title is-3">
        <span class="icon">
            <i class="fas fa-user-edit"></i>
        </span>
        <span>Mon profil</span>
    </h1>
    
    <form id="profileForm">
        <div class="columns">
            <div class="column is-8">
                <!-- Personal Information -->
                <h2 class="subtitle">Informations personnelles</h2>
                
                <div class="columns">
                    <div class="column">
                        <div class="field">
                            <label class="label">Prénom</label>
                            <div class="control">
                                <input class="input" type="text" id="firstName" required>
                            </div>
                        </div>
                    </div>
                    <div class="column">
                        <div class="field">
                            <label class="label">Nom</label>
                            <div class="control">
                                <input class="input" type="text" id="lastName" required>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="field">
                    <label class="label">Email</label>
                    <div class="control has-icons-left">
                        <input class="input" type="email" id="email" readonly>
                        <span class="icon is-left">
                            <i class="fas fa-envelope"></i>
                        </span>
                    </div>
                    <p class="help">L'email ne peut pas être modifié</p>
                </div>
                
                <div class="field">
                    <label class="label">Téléphone</label>
                    <div class="control has-icons-left">
                        <input class="input" type="tel" id="phone" required>
                        <span class="icon is-left">
                            <i class="fas fa-phone"></i>
                        </span>
                    </div>
                </div>
                
                <!-- Professional Information (if applicable) -->
                <div id="proInfo" style="display: none;">
                    <hr>
                    <h2 class="subtitle">Informations professionnelles</h2>
                    
                    <div class="field">
                        <label class="label">Nom de l'entreprise</label>
                        <div class="control">
                            <input class="input" type="text" id="companyName">
                        </div>
                    </div>
                    
                    <div class="field">
                        <label class="label">Numéro de TVA</label>
                        <div class="control">
                            <input class="input" type="text" id="vatNumber">
                        </div>
                    </div>
                    
                    <div class="field">
                        <label class="label">Types d'activité</label>
                        <div class="tags" id="activityTags"></div>
                    </div>
                </div>
                
                <hr>
                
                <!-- Submit Button -->
                <div class="field">
                    <div class="control">
                        <button type="submit" class="button button-autodin-dark">
                            <span class="icon">
                                <i class="fas fa-save"></i>
                            </span>
                            <span>Enregistrer les modifications</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="column is-4">
                <!-- Stats -->
                <div class="box has-background-light">
                    <h3 class="subtitle">Statistiques</h3>
                    <div class="level">
                        <div class="level-item has-text-centered">
                            <div>
                                <p class="heading">Annonces</p>
                                <p class="title">12</p>
                            </div>
                        </div>
                        <div class="level-item has-text-centered">
                            <div>
                                <p class="heading">Messages</p>
                                <p class="title">45</p>
                            </div>
                        </div>
                    </div>
                    <p class="has-text-grey is-size-7">Membre depuis <span id="memberSince"></span></p>
                </div>
                
                <!-- Account Type -->
                <div class="box has-background-light mt-4">
                    <h3 class="subtitle">Type de compte</h3>
                    <p class="has-text-weight-bold" id="accountType"></p>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
// Load user data
if (window.currentUser) {
    const user = window.currentUser;
    
    // Fill form fields
    document.getElementById('firstName').value = user.first_name || '';
    document.getElementById('lastName').value = user.last_name || '';
    document.getElementById('email').value = user.email || '';
    document.getElementById('phone').value = user.phone || '';
    
    // Account type
    const accountTypeText = user.account_type === 'professionnel' ? 'Professionnel' : 'Particulier';
    document.getElementById('accountType').textContent = accountTypeText;
    
    // Show professional fields if applicable
    if (user.account_type === 'professionnel') {
        document.getElementById('proInfo').style.display = 'block';
        document.getElementById('companyName').value = user.company_name || '';
        document.getElementById('vatNumber').value = user.vat_number || '';
        
        // Display activity types as tags
        if (user.pro_types && user.pro_types.length > 0) {
            const tagsContainer = document.getElementById('activityTags');
            user.pro_types.forEach(type => {
                const tag = document.createElement('span');
                tag.className = 'tag is-medium is-primary';
                tag.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                tagsContainer.appendChild(tag);
            });
        }
    }
    
    // Member since
    const createdAt = new Date(user.created_at || Date.now());
    document.getElementById('memberSince').textContent = createdAt.toLocaleDateString('fr-FR');
}

// Handle form submission
document.getElementById('profileForm').addEventListener('submit', function(e) {
    e.preventDefault();
    alert('Fonctionnalité de mise à jour du profil en cours de développement...');
});
</script>
{% endblock %}