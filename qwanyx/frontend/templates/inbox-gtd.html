<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IN</title>
    
    <!-- Google Fonts - Roboto -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            background: #1a1a2e;
            height: 100vh;
            margin: 0;
            padding: 0;
            position: relative;
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 18px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .columns-container {
            display: flex;
            gap: 20px;
            padding: 40px;
            height: calc(100vh - 40px);
            cursor: grab;
            user-select: none;
            overflow-x: hidden;
            overflow-y: hidden;
            align-items: stretch;
            box-sizing: border-box;
        }
        
        .columns-container.dragging {
            cursor: grabbing;
        }
        
        .column {
            min-width: 500px;
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            position: relative;
            transition: transform 0.3s ease;
        }
        
        .column.dragging {
            opacity: 0.3;
            transform: scale(0.95);
        }
        
        .column-ghost {
            position: fixed;
            min-width: 500px;
            height: auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            pointer-events: none;
            z-index: 10000;
            opacity: 0.8;
            transform: scale(0.9);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .column.drag-over {
            transform: translateX(10px);
        }
        
        .drop-indicator {
            position: absolute;
            width: 3px;
            height: 80%;
            top: 10%;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        
        .drop-indicator.active {
            opacity: 1;
        }
        
        .drop-indicator.left {
            left: -12px;
        }
        
        .drop-indicator.right {
            right: -12px;
        }
        
        .column-close {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.3);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .column-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }
        
        .column-header {
            color: white;
            font-size: 12px;
            margin-bottom: 15px;
            opacity: 0.5;
            cursor: pointer;
        }
        
        .column-header:hover {
            opacity: 0.8;
        }
        
        .column-header i {
            font-size: 12px;
        }
        
        .column-content {
            flex: 1;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: white;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .control-btn:active {
            transform: scale(0.9);
        }
        
        .control-btn.hidden {
            display: none;
        }
        
        .icon-search {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            outline: none;
        }
        
        .icon-search::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .icon-search:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .control-btn.dragging {
            opacity: 0.5;
        }
        
        .drag-ghost {
            position: fixed;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 10000;
            transition: none;
        }
    </style>
</head>
<body>
    <button class="close-btn" onclick="window.location.href='/dashboard'">
        <i class="fas fa-times"></i>
    </button>
    
    <div class="columns-container" id="columnsContainer">
        <!-- Columns will be added here dynamically -->
    </div>
    
    <script>
        // Create first column on load
        window.addEventListener('DOMContentLoaded', function() {
            // Start with one pen column by default
            addColumn('pen');
        });
        
        // Hide icon grids when clicking outside
        document.addEventListener('click', function(e) {
            // Don't hide if clicking on a column header or icon grid itself
            if (!e.target.closest('.column-header') && !e.target.closest('.icon-grid')) {
                document.querySelectorAll('.icon-grid').forEach(g => g.remove());
            }
        });
        
        function showIconGrid(header) {
            // First, close any other open grids
            document.querySelectorAll('.icon-grid').forEach(g => g.remove());
            
            const content = header.nextElementSibling;
            
            // Toggle grid visibility if it exists
            let grid = content.querySelector('.icon-grid');
            if (grid) {
                grid.remove();
                return;
            }
            
            // Create new grid
            grid = document.createElement('div');
            grid.className = 'icon-grid';
            grid.style.cssText = 'display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; padding: 20px; justify-items: center;';
            
            const iconTypes = ['pen', 'microphone', 'camera', 'comment', 'envelope', 'graduation-cap', 'address-book', 'users', 'project-diagram', 'robot', 'search'];
            const icons = ['fa-pen', 'fa-microphone', 'fa-camera', 'fa-comment', 'fa-envelope', 'fa-graduation-cap', 'fa-address-book', 'fa-users', 'fa-project-diagram', 'fa-robot', 'fa-search'];
            
            iconTypes.forEach((type, index) => {
                const btn = document.createElement('button');
                btn.className = 'control-btn';
                btn.innerHTML = `<i class="fas ${icons[index]}"></i>`;
                btn.dataset.type = type;
                
                // Make draggable with mouse events for better control
                let isDragging = false;
                let dragGhost = null;
                
                btn.onmousedown = function(e) {
                    // Check if it's a drag (hold for a moment)
                    const startX = e.clientX;
                    const startY = e.clientY;
                    let dragTimeout = setTimeout(() => {
                        isDragging = true;
                        
                        // Disable horizontal scrolling while dragging icon
                        window.iconDragging = true;
                        
                        // Create ghost element
                        dragGhost = document.createElement('div');
                        dragGhost.className = 'drag-ghost';
                        dragGhost.innerHTML = `<i class="fas ${icons[index]}"></i>`;
                        dragGhost.style.left = (e.clientX - 30) + 'px';
                        dragGhost.style.top = (e.clientY - 30) + 'px';
                        document.body.appendChild(dragGhost);
                        
                        btn.style.opacity = '0.3';
                    }, 200); // Start drag after 200ms hold
                    
                    const onMouseMove = function(e) {
                        if (isDragging && dragGhost) {
                            dragGhost.style.left = (e.clientX - 30) + 'px';
                            dragGhost.style.top = (e.clientY - 30) + 'px';
                        } else if (Math.abs(e.clientX - startX) > 5 || Math.abs(e.clientY - startY) > 5) {
                            // Movement detected before drag started - cancel drag
                            clearTimeout(dragTimeout);
                        }
                    };
                    
                    const onMouseUp = function(e) {
                        clearTimeout(dragTimeout);
                        
                        if (isDragging && dragGhost) {
                            const columns = document.querySelectorAll('.column');
                            let droppedOnColumn = false;
                            let insertPosition = null;
                            
                            // Check if dropped between columns
                            columns.forEach((col, index) => {
                                const rect = col.getBoundingClientRect();
                                
                                // Check if dropped on a column
                                if (e.clientX >= rect.left && e.clientX <= rect.right &&
                                    e.clientY >= rect.top && e.clientY <= rect.bottom) {
                                    droppedOnColumn = true;
                                }
                                
                                // Check if dropped between columns (in the gap)
                                if (index < columns.length - 1) {
                                    const nextCol = columns[index + 1];
                                    const nextRect = nextCol.getBoundingClientRect();
                                    const gapStart = rect.right;
                                    const gapEnd = nextRect.left;
                                    
                                    if (e.clientX > gapStart && e.clientX < gapEnd &&
                                        e.clientY >= rect.top && e.clientY <= rect.bottom) {
                                        insertPosition = nextCol;
                                    }
                                }
                            });
                            
                            // If dropped between columns, insert new column there
                            if (insertPosition) {
                                const newCol = createColumn(type);
                                container.insertBefore(newCol, insertPosition);
                                makeColumnDraggable(newCol);
                            }
                            // If not dropped on a column or between, create at the end
                            else if (!droppedOnColumn) {
                                addColumn(type);
                            }
                            
                            // Clean up ghost
                            dragGhost.remove();
                            dragGhost = null;
                            btn.style.opacity = '1';
                        } else if (!isDragging) {
                            // It was a click, not a drag
                            header.innerHTML = `<i class="fas ${icons[index]}"></i>`;
                            header.dataset.type = type;
                            grid.remove();
                        }
                        
                        isDragging = false;
                        window.iconDragging = false;  // Re-enable horizontal scrolling
                        
                        // Reset the column drag state to prevent jump
                        isDown = false;
                        container.classList.remove('dragging');
                        
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    };
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                    
                    e.preventDefault();
                };
                
                grid.appendChild(btn);
            });
            
            content.appendChild(grid);
        }
        
        function removeColumn(btn) {
            const columns = document.querySelectorAll('.column');
            if (columns.length > 1) {
                btn.parentElement.remove();
            }
        }
        
        function makeColumnDraggable(column) {
            let isDraggingColumn = false;
            let dragStartX = 0;
            let columnGhost = null;
            
            // Long press to start dragging column
            column.addEventListener('mousedown', function(e) {
                // Don't start if clicking on close button or header
                if (e.target.closest('.column-close') || e.target.closest('.column-header') || e.target.closest('.icon-grid')) {
                    return;
                }
                
                dragStartX = e.clientX;
                const startY = e.clientY;
                
                let dragTimeout = setTimeout(() => {
                    isDraggingColumn = true;
                    window.columnDragging = true;
                    column.classList.add('dragging');
                    
                    // Create ghost column
                    columnGhost = document.createElement('div');
                    columnGhost.className = 'column-ghost';
                    columnGhost.innerHTML = column.innerHTML;
                    columnGhost.style.left = (e.clientX - 250) + 'px'; // Center on cursor
                    columnGhost.style.top = (e.clientY - 100) + 'px';
                    document.body.appendChild(columnGhost);
                    
                    // Disable text selection
                    document.body.style.userSelect = 'none';
                }, 400); // Longer delay for column drag
                
                const onMouseMove = function(e) {
                    if (isDraggingColumn && columnGhost) {
                        // Move ghost column with cursor
                        columnGhost.style.left = (e.clientX - 250) + 'px';
                        columnGhost.style.top = (e.clientY - 100) + 'px';
                        
                        // Find which column we're over
                        const columns = document.querySelectorAll('.column:not(.dragging)');
                        columns.forEach(col => {
                            const rect = col.getBoundingClientRect();
                            const midpoint = rect.left + rect.width / 2;
                            
                            // Clear previous indicators
                            col.querySelectorAll('.drop-indicator').forEach(ind => ind.classList.remove('active'));
                            
                            if (e.clientX >= rect.left && e.clientX <= rect.right) {
                                if (e.clientX < midpoint) {
                                    col.querySelector('.drop-indicator.left').classList.add('active');
                                } else {
                                    col.querySelector('.drop-indicator.right').classList.add('active');
                                }
                            }
                        });
                    } else if (Math.abs(e.clientX - dragStartX) > 5 || Math.abs(e.clientY - startY) > 5) {
                        clearTimeout(dragTimeout);
                    }
                };
                
                const onMouseUp = function(e) {
                    clearTimeout(dragTimeout);
                    
                    if (isDraggingColumn) {
                        // Find drop position
                        const columns = Array.from(document.querySelectorAll('.column:not(.dragging)'));
                        let insertBefore = null;
                        
                        columns.forEach(col => {
                            const rect = col.getBoundingClientRect();
                            const midpoint = rect.left + rect.width / 2;
                            
                            if (e.clientX >= rect.left && e.clientX <= rect.right) {
                                if (e.clientX < midpoint) {
                                    insertBefore = col;
                                } else {
                                    insertBefore = col.nextElementSibling;
                                }
                            }
                        });
                        
                        if (insertBefore && insertBefore !== column) {
                            container.insertBefore(column, insertBefore);
                        } else if (!insertBefore && e.clientX > columns[columns.length - 1]?.getBoundingClientRect().right) {
                            container.appendChild(column);
                        }
                        
                        // Clean up
                        column.classList.remove('dragging');
                        document.querySelectorAll('.drop-indicator').forEach(ind => ind.classList.remove('active'));
                        document.body.style.userSelect = '';
                        
                        // Remove ghost
                        if (columnGhost) {
                            columnGhost.remove();
                            columnGhost = null;
                        }
                    }
                    
                    isDraggingColumn = false;
                    window.columnDragging = false;
                    isDown = false; // Reset column scroll state
                    
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                };
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
        }
        
        function createColumn(type) {
            const column = document.createElement('div');
            column.className = 'column';
            
            const icons = {
                'pen': 'fa-pen',
                'microphone': 'fa-microphone',
                'camera': 'fa-camera',
                'comment': 'fa-comment',
                'envelope': 'fa-envelope',
                'graduation-cap': 'fa-graduation-cap',
                'address-book': 'fa-address-book',
                'users': 'fa-users',
                'project-diagram': 'fa-project-diagram',
                'robot': 'fa-robot',
                'search': 'fa-search'
            };
            
            column.innerHTML = `
                <div class="drop-indicator left"></div>
                <div class="drop-indicator right"></div>
                <button class="column-close" onclick="removeColumn(this)">
                    <i class="fas fa-times"></i>
                </button>
                <div class="column-header" onclick="showIconGrid(this)">
                    <i class="fas ${icons[type]}"></i>
                </div>
                <div class="column-content">
                    
                </div>
            `;
            
            return column;
        }
        
        function addColumn(type) {
            const container = document.getElementById('columnsContainer');
            const column = createColumn(type);
            makeColumnDraggable(column);
            container.appendChild(column);
        }
        
        // Drag to move columns with inertia
        let isDown = false;
        let startX;
        let scrollLeft;
        let velocity = 0;
        let momentumID;
        let lastX;
        let lastTime;
        const container = document.getElementById('columnsContainer');
        
        function momentumScroll() {
            if (Math.abs(velocity) > 0.5) {
                container.scrollLeft += velocity;
                velocity *= 0.95; // friction
                momentumID = requestAnimationFrame(momentumScroll);
            }
        }
        
        container.addEventListener('mousedown', (e) => {
            // Don't start drag if we're dragging an icon or column
            if (window.iconDragging || window.columnDragging) return;
            
            isDown = true;
            container.classList.add('dragging');
            startX = e.pageX - container.offsetLeft;
            scrollLeft = container.scrollLeft;
            lastX = e.pageX;
            lastTime = Date.now();
            velocity = 0;
            cancelAnimationFrame(momentumID);
        });
        
        container.addEventListener('mouseleave', () => {
            if (isDown && !window.iconDragging) {
                isDown = false;
                container.classList.remove('dragging');
                momentumScroll();
            }
        });
        
        container.addEventListener('mouseup', () => {
            if (isDown && !window.iconDragging) {
                isDown = false;
                container.classList.remove('dragging');
                momentumScroll();
            }
        });
        
        container.addEventListener('mousemove', (e) => {
            // Don't scroll if we're dragging an icon
            if (window.iconDragging) return;
            
            if(!isDown) return;
            e.preventDefault();
            
            const now = Date.now();
            const dt = now - lastTime;
            const dx = e.pageX - lastX;
            
            velocity = -dx * 0.5; // calculate velocity
            
            const x = e.pageX - container.offsetLeft;
            const walk = (x - startX) * 2;
            container.scrollLeft = scrollLeft - walk;
            
            lastX = e.pageX;
            lastTime = now;
        });
        
    </script>
</body>
</html>