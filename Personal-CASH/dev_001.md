# Cash Management System - État de développement

## Vue d'ensemble
Système de gestion de trésorerie développé pour un utilisateur belge avec des besoins spécifiques de suivi des dettes, créances et flux de trésorerie. Le système a évolué de manière organique selon les besoins réels.

## Fonctionnalités principales implémentées

### 1. Gestion unifiée des transactions
- **Modèle unifié** : Payables et Receivables dans une seule table `Transaction`
- **Drag & Drop** : Réorganisation manuelle des transactions pour planifier les paiements
- **Statuts** : pending, completed, cancelled
- **Types** : payable (à payer), receivable (à recevoir)

### 2. Gestion de la TVA belge
- Taux supportés : 0%, 6%, 12%, 21%
- Calcul automatique sur montant net
- Création automatique des transactions TVA trimestrielles
- Date limite : 25 du mois suivant le trimestre (changé en 2025)

### 3. Traitement automatique des documents (dossier IN)
- Support PDF, images (PNG/JPG), fichiers texte
- Extraction automatique des informations (PDFs)
- Pré-remplissage du formulaire de transaction
- Déplacement automatique vers IN/processed après traitement

### 4. QR Codes SEPA pour paiements
- Génération de QR codes standard EPC (European Payments Council)
- Support des communications structurées belges
- Aucune connexion bancaire requise
- Bouton QR sur chaque transaction payable avec compte bancaire

### 5. Communications et comptes bancaires
- **Communication structurée** : Format +++XXX/XXXX/XXXXX+++
  - Validation modulo 97
  - Formatage automatique lors de la saisie
- **Communication libre** : Texte personnalisé
- **Formatage IBAN** : BE12 3456 7890 1234 automatique
- **Mémoire des comptes** : Dropdown des comptes déjà utilisés par bénéficiaire

### 6. Transactions récurrentes
- Fréquences : mensuelle, trimestrielle, annuelle
- Génération automatique des occurrences
- Nombre configurable d'occurrences

### 7. Visualisation du cash flow
- Graphique en barres avec montants affichés
- Projection sur 12 mois
- Support des valeurs négatives
- Basé sur l'ordre manuel des transactions

### 8. Système de backup automatique
- Sauvegarde automatique au démarrage de l'app
- Conservation des 10 dernières sauvegardes
- Stockage dans le dossier `backups/`
- Format : `cash_management_backup_YYYYMMDD_HHMMSS.db`

## Architecture technique

### Backend
- **Framework** : Flask (Python)
- **Base de données** : SQLite avec SQLAlchemy ORM
- **Bibliothèques clés** :
  - pdfplumber : extraction PDF
  - qrcode : génération QR codes
  - Chart.js : graphiques
  - SortableJS : drag & drop

### Modèles de données principaux
```python
Transaction:
  - id, type, counterparty_id, counterparty_name
  - amount, net_amount, vat_percentage
  - description, structured_communication, free_communication
  - bank_account, due_date, status
  - display_order (pour le tri manuel)
  - is_recurring, recurring_frequency, recurring_day

Creditor/Counterparty:
  - id, name, bank_name, account_number
```

### Frontend
- Templates Jinja2
- JavaScript vanilla pour l'interactivité
- Chart.js pour les graphiques
- SortableJS pour le drag & drop

## Configurations par défaut (optimisées pour l'utilisateur)
- TVA : 0% (80% des transactions sans TVA)
- Communication : Structurée (standard belge)
- Bouton "Today" pour date d'échéance rapide

## Améliorations futures (dans les todos)
1. **Mise en ligne** (priorité moyenne)
   - Hébergement cloud
   - Authentification sécurisée
   - HTTPS
   - Optimisation mobile

2. **Système de comptes prépayés** (priorité basse)
   - Comptes clients avec solde
   - QR codes personnels
   - Recharge par virement
   - Contournement des frais de virement instantané

## Points d'attention
- Les montants sont entrés **hors TVA** (net)
- La TVA est calculée automatiquement
- `remaining_amount` est une propriété calculée (ne pas assigner directement)
- Les virements instantanés SEPA (10 sec) coûtent 0,50-1€ (payé par l'émetteur)

## Commandes utiles
```bash
# Démarrer l'application
python app.py

# Créer une migration
python add_[nom_colonne].py

# L'app est accessible sur
http://127.0.0.1:5000
```

## État actuel
- Système pleinement fonctionnel
- Interface intuitive avec drag & drop
- QR codes pour paiements mobiles
- Backup automatique des données
- Prêt pour usage quotidien

## Dernières modifications
- Ajout du système de backup automatique
- Menu déroulant pour sélection des comptes bancaires par bénéficiaire
- Communication structurée par défaut
- TVA 0% par défaut
- Bouton "Today" pour date d'échéance